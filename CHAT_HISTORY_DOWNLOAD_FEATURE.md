# Chat History Download Feature

## 功能说明

在管理员面板的聊天历史页面中，新增了按课程下载聊天历史的功能。

## 使用方法

1. **进入管理员面板**
   - 访问 `/admin` 页面
   - 点击左侧菜单中的 "Chat History"

2. **选择课程**
   - 在过滤器中选择要下载聊天历史的课程
   - 可选择性地设置日期范围（开始日期和结束日期）

3. **下载选项**
   - 选择课程后，过滤器下方会显示下载选项
   - 提供两种格式：
     - **JSON格式**: 包含完整的聊天数据结构，适合程序处理
     - **CSV格式**: 表格格式，适合在Excel等工具中分析

## 下载内容

每个下载文件包含以下信息：

### 聊天基本信息
- 聊天ID
- 聊天名称
- 创建时间
- 最后更新时间
- 消息数量

### 用户信息
- 用户姓名
- 用户邮箱

### 课程信息
- 课程ID
- 课程名称

### 使用统计
- 总Token数
- 预估费用

### 消息内容
- 完整的聊天对话记录
- 每条消息的角色（用户/助手）
- 消息时间戳
- 是否包含图片

## 文件命名

下载的文件会自动命名为：
- JSON: `chat_history_{课程名称}_{日期}.json`
- CSV: `chat_history_{课程名称}_{日期}.csv`

## API端点

新增的API端点：
- `GET /api/admin/chat-history/export`
- 参数：
  - `courseId`: 必需，课程ID
  - `format`: 可选，文件格式（json/csv），默认为json
  - `startDate`: 可选，开始日期
  - `endDate`: 可选，结束日期

## 注意事项

1. 必须先选择课程才能使用下载功能
2. 下载的数据会根据设置的日期范围进行过滤
3. 大量数据的下载可能需要一些时间，请耐心等待
4. 下载功能需要管理员权限
