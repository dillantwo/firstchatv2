@import "tailwindcss";

@theme {
  --color-primary: #4d6bfe;
}

html{
  @apply scroll-smooth;
  margin: 0;
  padding: 0;
  background-color: #292a2d; /* 确保整个页面都有正确的背景色 */
  /* 支持动态视口高度 */
  --vh: 1vh;
}

body {
  margin: 0;
  padding: 0;
  background-color: #292a2d; /* 确保body也有正确的背景色 */
}

::-webkit-scrollbar{
  display: none;
}

/* 自定义滚动条样式 */
.scrollbar-thin {
  scrollbar-width: thin;
}

.scrollbar-thin::-webkit-scrollbar {
  width: 6px;
  display: block;
}

.scrollbar-thumb-gray-600::-webkit-scrollbar-thumb {
  background-color: rgba(75, 85, 99, 0.6);
  border-radius: 3px;
}

.scrollbar-thumb-gray-600::-webkit-scrollbar-thumb:hover {
  background-color: rgba(75, 85, 99, 0.8);
}

/* 文本截断样式 */
.line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Pinned Messages 自适应布局 - 1.5倍关系 */
@media (min-width: 640px) {
  .pinned-panel-layout {
    width: 60%; /* Pinned Messages 占 60% */
  }
  
  .chat-container-with-pinned {
    margin-right: 60%; /* Chat 区域右边距 60%，实际可用空间 40% */
  }
}

/* 在更大屏幕上微调比例以保持良好的用户体验 */
@media (min-width: 1024px) {
  .pinned-panel-layout {
    width: 58%; /* 稍微减少以在大屏幕上提供更好的阅读体验 */
  }
  
  .chat-container-with-pinned {
    margin-right: 58%;
  }
}

@media (min-width: 1280px) {
  .pinned-panel-layout {
    width: 55%; /* 在超大屏幕上进一步优化 */
  }
  
  .chat-container-with-pinned {
    margin-right: 55%;
  }
}

.line-clamp-4 {
  display: -webkit-box;
  -webkit-line-clamp: 4;
  line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Pinned message styles */
.pinned-message-container {
  transform-origin: top left;
}

.pinned-message-container .message-content {
  max-width: 100%;
  word-wrap: break-word;
}

.scrollbar-track-transparent::-webkit-scrollbar-track {
  background-color: transparent;
}

/* 隐藏滚动条，除非内容溢出 */
.chat-list-container {
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: rgba(75, 85, 99, 0.6) transparent;
}

.chat-list-container::-webkit-scrollbar {
  width: 6px;
}

.chat-list-container::-webkit-scrollbar-track {
  background: transparent;
}

.chat-list-container::-webkit-scrollbar-thumb {
  background-color: rgba(75, 85, 99, 0.6);
  border-radius: 3px;
}

.chat-list-container::-webkit-scrollbar-thumb:hover {
  background-color: rgba(75, 85, 99, 0.8);
}
.loader div:nth-child(2){
  animation-delay: 0.2s;
}
.loader div:nth-child(3){
  animation-delay: 0.4s;
}

code{
  white-space: pre-wrap !important;
}

pre{
  border-radius: 10px !important;
}

/* KaTeX 数学公式样式 */
.katex {
  font-size: 1.6em !important;
}

.katex-display {
  font-size: 1.8em !important;
  margin: 1.5em 0 !important;
}

/* 行内数学公式 */
.katex-mathml {
  font-size: 1.4em !important;
}

/* 块级数学公式额外样式 */
.katex-display > .katex {
  font-size: 2em !important;
  text-align: center !important;
}

/* Markdown表格美化样式 */
.markdown-table-wrapper {
  margin: 1.5rem 0;
  border-radius: 0.5rem;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
}

/* 表格基础样式 - 自动换行优化 */
table {
  width: 100%;
  border-collapse: collapse;
  background-color: white;
  border-radius: 0.5rem;
  overflow: hidden;
  table-layout: auto;
  word-break: break-word;
}

/* 表头样式 */
table thead {
  background-color: #f9fafb;
}

table th {
  padding: 0.75rem 1rem;
  text-align: left;
  font-size: 0.75rem;
  font-weight: 500;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px solid #e5e7eb;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  white-space: normal;
  line-height: 1.4;
}

/* 表格内容样式 - 自动换行 */
table td {
  padding: 0.75rem 1rem;
  font-size: 0.875rem;
  color: #1f2937;
  border-bottom: 1px solid #e5e7eb;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  white-space: normal;
  line-height: 1.6;
  vertical-align: top;
}

/* 表格行悬停效果 */
table tbody tr:hover {
  background-color: #f9fafb;
  transition: background-color 0.15s ease-in-out;
}

/* 最后一行去掉下边框 */
table tbody tr:last-child td {
  border-bottom: none;
}

/* 响应式设计 - 更紧凑的移动端样式 */
@media (max-width: 640px) {
  table th,
  table td {
    padding: 0.5rem 0.75rem;
    font-size: 0.8rem;
    line-height: 1.5;
  }
  
  table th {
    font-size: 0.7rem;
  }
}

/* 确保长单词和URL能够断行 */
table th *,
table td * {
  word-break: break-word;
  overflow-wrap: break-word;
}

/* Tooltip 样式改进 - 确保不重叠 */
.tooltip {
  z-index: 99999 !important;
  position: absolute;
  pointer-events: none;
  white-space: nowrap;
}

/* 确保group hover tooltips有正确的层级 */
.group:hover .tooltip,
.group-hover\:opacity-100 {
  z-index: 99999 !important;
}

/* 确保所有悬停提示都在最顶层 */
[class*="group-hover:opacity-100"],
[class*="z-[9999]"] {
  z-index: 99999 !important;
}

/* iPad Safari 特定优化 */
@supports (-webkit-touch-callout: none) {
  /* iOS Safari 特定样式 */
  html, body {
    height: 100vh;
    height: -webkit-fill-available;
    overflow-x: hidden;
  }
  
  /* 修复iOS Safari中100vh的问题 */
  .h-screen {
    height: 100vh;
    height: -webkit-fill-available;
  }
  
  /* 防止iOS Safari中的橡皮筋效果 */
  body {
    position: fixed;
    width: 100%;
    overflow: hidden;
  }
  
  /* 确保主容器可以滚动 */
  .main-container {
    height: 100vh;
    height: -webkit-fill-available;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* iPad 专用样式 (iPad 和 iPad Pro) - 适用于所有浏览器 */
@media only screen 
  and (min-device-width: 768px) 
  and (max-device-width: 1366px) 
  and (-webkit-min-device-pixel-ratio: 1),
  screen and (min-width: 768px) and (max-width: 1024px) and (pointer: coarse) {
  
  /* 确保界面完全适应iPad屏幕 - 兼容Chrome和Safari */
  html, body {
    width: 100%;
    height: 100vh;
    height: calc(var(--vh, 1vh) * 100); /* 使用动态视口高度 */
    height: 100svh; /* 新的视口单位，适用于动态视口 */
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    background-color: #292a2d;
  }
  
  /* iPad Portrait - 适用于所有浏览器 */
  @media (orientation: portrait) {
    .chat-container {
      max-width: 100%;
      padding: 0 16px;
      min-height: calc(100vh - 20px); /* 稍微减少bottom margin，增加高度 */
      min-height: calc(100svh - 20px);
    }
    
    /* 调整固定按钮位置 */
    .fixed {
      position: absolute;
    }
    
    /* 确保输入框不被虚拟键盘遮挡 */
    .prompt-container {
      padding-bottom: env(safe-area-inset-bottom, 8px); /* 从15px减少到8px */
      margin-bottom: 8px; /* 从15px减少到8px */
    }
    
    /* 主容器添加安全区域适配 */
    .main-container {
      height: 100vh;
      height: calc(var(--vh, 1vh) * 100);
      height: 100svh;
      padding-bottom: env(safe-area-inset-bottom, 0px);
    }
    
    /* iPad竖屏：隐藏chat title和chatflow title */
    p.fixed {
      display: none !important;
    }
    
    /* 更具体的选择器：隐藏固定位置的标题 */
    p.fixed.top-8,
    p.fixed.top-20 {
      display: none !important;
    }
    
    /* iPad竖屏：减少移动端导航栏高度 */
    .md\\:hidden.absolute {
      top: 0.25rem !important; /* 更靠近顶部 */
      height: 2rem !important; /* 固定高度 */
    }
    
    /* iPad竖屏：调整Pin按钮位置 */
    button.fixed.top-3.right-4 {
      top: 0.5rem !important; /* 更靠近顶部 */
      right: 1rem !important;
    }
    
    /* 由于隐藏了标题，减少聊天容器的顶部边距 */
    .relative.flex.flex-col.items-center.justify-start {
      margin-top: 30px !important; /* 减少顶部边距，为聊天区域留更多空间 */
    }
    
    /* iPad竖屏：调整pin按钮位置，增加与下方内容的间距 */
    button.fixed.top-3.right-4 {
      top: 2rem !important; /* 保持距离顶部的距离 */
      right: 2rem !important; /* 增加右侧间距 */
      margin-bottom: 20px !important; /* 增加底部间距 */
      transform: translateY(10px); /* 额外向下移动一点 */
    }
    
    /* 确保pin按钮不与其他内容重叠 */
    .chat-container {
      padding-top: 80px !important; /* 为pin按钮预留空间 */
    }
  }
  
  /* iPad Landscape - 修复白线问题，兼容Chrome */
  @media (orientation: landscape) {
    /* 强制设置根元素背景 */
    * {
      box-sizing: border-box;
    }
    
    html, body, #__next {
      width: 100vw;
      height: 100vh;
      height: 100svh; /* 新的视口单位 */
      margin: 0;
      padding: 0;
      background-color: #292a2d !important;
      overflow-x: hidden;
    }
    
    .main-container {
      width: 100vw;
      height: 100vh;
      height: calc(var(--vh, 1vh) * 100);
      height: 100svh;
      background-color: #292a2d !important;
      margin: 0;
      padding: 0;
      padding-bottom: env(safe-area-inset-bottom, 0px);
    }
    
    .chat-container {
      max-width: 90%;
      margin: 0 auto;
      background-color: #292a2d !important;
      min-height: calc(100vh - 60px); /* 从80px减少到60px，增加20px高度 */
      min-height: calc((var(--vh, 1vh) * 100) - 60px);
      min-height: calc(100svh - 60px);
    }
    
    /* 横屏时侧边栏自动显示 */
    .sidebar-auto-expand {
      display: block;
    }
    
    /* 确保flex容器完全填充 */
    .flex.h-screen {
      width: 100vw;
      height: 100vh;
      height: 100svh;
      background-color: #292a2d !important;
      margin: 0;
      padding: 0;
    }
    
    /* 确保底部内容不被浏览器UI遮挡 */
    .prompt-container {
      margin-bottom: max(12px, env(safe-area-inset-bottom));
    }
    
    /* iPad横屏：隐藏chat title和chatflow title */
    p.fixed {
      display: none !important;
    }
    
    /* 更具体的选择器：隐藏固定位置的标题 */
    p.fixed.top-8,
    p.fixed.top-20 {
      display: none !important;
    }
    
    /* 由于隐藏了标题，减少聊天容器的顶部边距 */
    .relative.flex.flex-col.items-center.justify-start {
      margin-top: 30px !important; /* 横屏时更少的顶部边距，为聊天区域留更多空间 */
    }
    
    /* iPad横屏：减少移动端导航栏高度 */
    .md\\:hidden.absolute {
      top: 0.25rem !important; /* 更靠近顶部 */
      height: 1.75rem !important; /* 横屏时稍微更小 */
    }
    
    /* iPad横屏：调整pin按钮位置，增加与下方内容的间距 */
    button.fixed.top-3.right-4 {
      top: 0.5rem !important; /* 横屏时距离顶部更近一些 */
      right: 1rem !important; /* 减少右侧间距 */
      margin-bottom: 12px !important; /* 减少底部间距 */
      transform: translateY(4px); /* 减少向下移动 */
    }
    
    /* 确保pin按钮不与其他内容重叠 */
    .chat-container {
      padding-top: 60px !important; /* 为pin按钮预留空间 */
    }
  }
}

/* 通用移动设备优化 - 包括iPad Chrome */
@media (max-width: 1024px) {
  /* 防止水平滚动 */
  * {
    max-width: 100%;
    box-sizing: border-box;
  }
  
  /* 优化触摸目标大小 */
  button, 
  [role="button"],
  input,
  textarea {
    min-height: 44px; /* Apple HIG 推荐的最小触摸目标 */
    min-width: 44px;
  }
  
  /* 改善滚动性能 */
  .overflow-y-auto {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }
  
  /* iPad Chrome特定：确保界面完整显示 */
  .main-container {
    min-height: 100vh;
    min-height: 100svh;
    position: relative;
  }
  
  /* 确保底部输入框可见 */
  .prompt-container {
    position: relative;
    z-index: 10;
    margin-bottom: max(env(safe-area-inset-bottom, 12px), 16px);
  }
  
  /* 聊天容器适配 */
  .chat-container {
    padding-bottom: 80px; /* 为输入框预留足够空间，从120px减少到80px */
    min-height: calc(100vh - 200px);
    min-height: calc(100svh - 200px);
  }
}

/* 修复Safari中的输入框问题 */
input, textarea {
  -webkit-appearance: none;
  appearance: none;
  border-radius: 0;
}

/* 防止Safari中的缩放 */
input[type="text"],
input[type="search"],
textarea {
  font-size: 16px; /* 防止iOS Safari自动缩放 */
}

/* 优化选择器下拉菜单在移动设备上的显示 */
@media (max-width: 768px) {
  select {
    font-size: 16px;
    padding: 12px;
  }
  
  /* 移动端：减少顶部导航栏高度 */
  .md\\:hidden.absolute.px-2.sm\\:px-4 {
    top: 0.25rem !important; /* 减少顶部距离 */
    height: 2rem !important; /* 固定高度为32px */
  }
  
  /* 移动端：调整Pin按钮位置 */
  button.fixed.top-3.right-4 {
    top: 0.5rem !important; /* 更靠近顶部 */
    right: 1rem !important;
    padding: 0.375rem !important; /* 减少内边距 */
  }
  
  /* 移动端：减少图标大小 */
  .md\\:hidden img {
    width: 1.25rem !important; /* 20px */
    height: 1.25rem !important; /* 20px */
  }
}

/* 专门针对 iPad Safari 和 Chrome 的修复 */
@media screen and (min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 1),
       screen and (min-width: 768px) and (max-width: 1024px) and (pointer: coarse) {
  /* iPad 特定修复 - 兼容Chrome和Safari */
  .flex.h-screen {
    min-height: 100vh;
    min-height: 100svh; /* 新的视口单位 */
    min-height: -webkit-fill-available;
  }
  
  /* 确保聊天容器不会被截断 */
  .chat-container {
    min-height: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    background-color: #292a2d; /* 确保背景色完全覆盖 */
    padding-bottom: env(safe-area-inset-bottom, 20px);
  }
  
  /* 修复 iPad 上的 textarea 缩放问题 */
  textarea {
    transform: translateZ(0); /* 强制硬件加速 */
    -webkit-transform: translateZ(0);
    font-size: 16px !important; /* 防止Chrome自动缩放 */
  }
  
  /* 修复横屏时的白线问题 - Chrome兼容 */
  @media (orientation: landscape) {
    body {
      margin: 0;
      padding: 0;
      background-color: #292a2d;
      overflow-x: hidden;
      min-height: 100vh;
      min-height: 100svh;
    }
    
    html {
      margin: 0;
      padding: 0;
      background-color: #292a2d;
      min-height: 100vh;
      min-height: 100svh;
    }
    
    /* 确保主容器完全填充屏幕 */
    .main-container {
      width: 100vw;
      height: 100vh;
      height: 100svh;
      height: -webkit-fill-available;
      margin: 0;
      padding: 0;
      background-color: #292a2d;
      padding-bottom: max(env(safe-area-inset-bottom, 0px), 20px);
    }
    
    /* 确保flex容器没有边距 */
    .flex.h-screen {
      width: 100%;
      height: 100vh;
      height: 100svh;
      height: -webkit-fill-available;
      margin: 0;
      background-color: #292a2d;
    }
    
    /* Chrome特定：确保底部内容可见 */
    .prompt-container {
      position: relative;
      margin-bottom: max(env(safe-area-inset-bottom, 12px), 20px);
      padding-bottom: 6px;
    }
  }
  
  /* Portrait模式的Chrome优化 */
  @media (orientation: portrait) {
    .main-container {
      padding-bottom: max(env(safe-area-inset-bottom, 12px), 16px);
    }
    
    .prompt-container {
      margin-bottom: max(env(safe-area-inset-bottom, 10px), 14px);
    }
  }
}

/* 通用的防止缩放样式 */
@media (max-width: 1024px) {
  /* 防止意外的水平滚动 */
  body {
    overflow-x: hidden;
    background-color: #292a2d;
  }
  
  /* 确保所有容器都不会超出视口 */
  .container, .flex, div {
    max-width: 100vw;
    box-sizing: border-box;
  }
  
  /* 优化按钮大小以适合触摸 */
  button {
    min-height: 44px;
    padding: 8px 12px;
  }
  
  /* 修复移动端固定定位 */
  .fixed {
    position: absolute;
  }
  
  /* 优化移动端的消息容器 */
  .message-container {
    padding: 8px 12px;
    max-width: calc(100vw - 24px);
  }
  
  /* 修复移动端Sidebar高度问题 */
  .max-md\:h-screen {
    height: 100vh !important;
    height: -webkit-fill-available !important;
    min-height: 100vh;
    min-height: -webkit-fill-available;
  }
  
  /* 确保绝对定位的Sidebar完全覆盖 */
  .max-md\:absolute {
    top: 0;
    left: 0;
    bottom: 0;
  }
}

/* 取消固定按钮美化样式 */
.unpin-button {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.15));
  backdrop-filter: blur(8px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.unpin-button:hover {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.25));
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(239, 68, 68, 0.2);
}

.unpin-button:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* 取消固定按钮图标动画 */
.unpin-button svg {
  transition: transform 0.2s ease-in-out;
}

.unpin-button:hover svg {
  transform: rotate(45deg) scale(1.1);
}

/* 确保在触摸设备上按钮足够大 */
@media (max-width: 640px) {
  .unpin-button {
    min-height: 36px;
    min-width: 36px;
    padding: 8px 10px;
    font-size: 0.75rem;
  }
}

/* iPad 和平板优化 */
@media (min-width: 641px) and (max-width: 1024px) {
  .unpin-button {
    min-height: 32px;
    padding: 6px 12px;
    font-size: 0.75rem;
  }
}

/* 增强触摸区域 */
.unpin-button::before {
  content: '';
  position: absolute;
  top: -4px;
  left: -4px;
  right: -4px;
  bottom: -4px;
  background: transparent;
}